# This is the GitHub Actions workflow file.
# It defines the CI/CD pipeline.
#
# It will run on every push to the 'main' branch.
#
# It securely logs into AWS using an OIDC role and then
# syncs the contents of the repository to your S3 bucket.

name: Deploy Static Site to AWS S3

on:
  # Triggers the workflow on push events for the "main" branch
  push:
    branches: ["main"]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# Grant permissions for the workflow to request an OIDC token
permissions:
  id-token: write # Required for OIDC authentication with AWS
  contents: read # Required to check out the repository's code

jobs:
  deploy-to-s3:
    name: Deploy to AWS S3
    runs-on: ubuntu-latest # Use a standard Linux runner

    steps:
      # Step 1: Check out the code from the repository
      - name: Check out repository
        uses: actions/checkout@v4

      # Step 2: Configure AWS Credentials using OIDC
      # This step securely authenticates with AWS using the IAM Role
      # specified in your GitHub repository secrets.
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          # The ARN of the IAM Role to assume
          role-to-assume: ${{ secrets.AWS_ROLE_ARN }}
          # Your AWS region
          aws-region: ${{ secrets.AWS_REGION }}

      # Step 3: Deploy files to S3
      # This command syncs the current directory (your repo)
      # with the specified S3 bucket.
      - name: Deploy static site to S3 bucket
        run: |
          aws s3 sync . s3://${{ secrets.AWS_S3_BUCKET }} --delete
